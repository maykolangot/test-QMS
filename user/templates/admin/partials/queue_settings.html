{% extends 'admin/dashboard-admin.html' %}

{% block content %}

<style>
    .table-responsive {
    max-height: 300px;
    overflow-y: auto;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    position: relative;
}

.table thead th {
    position: sticky;
    top: 0;
    background-color: #f8f9fa; /* Light background for better contrast */
    z-index: 1; /* Ensure it stays above table rows */
}

</style>


<div class="container mt-4">
    <!-- Page Title -->
    <h3 class="mb-4 fw-bold">
        <i class="bi bi-sliders"></i> Queue Cutoff Settings
    </h3>

    <!-- Form Card -->
    <div class="card shadow-sm mb-5">
        <div class="card-body">
            <!--<form id="queue-cutoff-form" method="POST" action="{% url 'admin_queue_settings' %}"> -->
            <form id="queue-cutoff-form" method="POST" action="{% url 'admin_queue_settings' %}">
                {% csrf_token %}
    
                <!-- Row for Campus and Cutoff Time side-by-side -->
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="campus" class="form-label fw-semibold">Campus (optional)</label>
                        <select name="campus" id="campus" class="form-select">
                            <option value="">-- All Campuses --</option>
                            {% for value, label in campus_choices %}
                            <option value="{{ value }}">{{ label }}</option>
                            {% endfor %}
                        </select>
                    </div>
    
                    <div class="col-md-6 mb-3">
                        <label for="cutoff_time" class="form-label fw-semibold">
                            Schedule Cutoff Time <span class="text-muted">(leave blank to cut now)</span>
                        </label>
                        <input type="time" name="cutoff_time" id="cutoff_time" class="form-control">
                    </div>
                </div>
    
                <div class="form-check mb-3">
                    <input type="checkbox" name="prioritize" class="form-check-input" id="prioritize">
                    <label class="form-check-label" for="prioritize">Only cut non-priority transactions</label>
                </div>
    
                <div class="d-flex justify-content-center">
                    <button type="submit" class="btn btn-danger" style="width: 25%;">
                        <i class="bi bi-scissors"></i> Apply Cutoff
                    </button>
                </div>
                
                
            </form>
        </div>
    </div>
    

    <!-- Cutoff Result Alert -->
    {% if cutoff_result %}
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="bi bi-check-circle-fill me-2"></i>
        {{ cutoff_result }} transaction{{ cutoff_result|pluralize }} cut off.
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endif %}




<script>


    document.addEventListener('DOMContentLoaded', () => {
    const form = document.getElementById('queue-cutoff-form');
    if (!form) return;

    form.addEventListener('submit', function (e) {
        e.preventDefault();

        const formData = new FormData(form);

        fetch(form.action || window.location.pathname, {
            method: 'POST',
            headers: {
                'X-CSRFToken': getCSRFToken()
            },
            body: formData
        })
        .then(response => {
            if (!response.ok) throw new Error("Form submission failed.");
            return response.text();
        })
        .then(html => {
            document.getElementById('admin-content').innerHTML = html;
        })
        .catch(err => {
            console.error("Error submitting cutoff form:", err);
            alert("Cutoff failed. Please try again.");
        });
    });
});


</script>

{% endblock %}